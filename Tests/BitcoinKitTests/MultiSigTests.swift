//
//  MultiSigTests.swift
//  
//
//  Created by liugang zhang on 2024/5/9.
//

import XCTest
@testable import BitcoinKit

final class MultiSigTests: XCTestCase {

    func testMultiSig2of4() throws {
        let keys = [
            "da74ae306a968f377e1b51460c253031f043b4f359dc5bfda3b1ae785173c9c4",
            "25738c1e747039d32889300b91b17038e8bd2b14224ff507f35887edc8f56c2e",
            "c5128c891577c71735cb4f95c88e5c557e20a5ca85ab269dc4949d5f2e17836f",
            "f7636a24b45809967049232963f4b8689c356fee2e5aa6df9a33d2f13d150b98"
        ].map { PrivateKey(data: Data(hex: $0)) }

        let psbt = try Psbt.deserialize("70736274ff0100550200000001ecfb41d7842ba9cbf16c80b1fba9930f6da0726623c0e1f5e3aec9e236839e5b0000000000ffffffff0110270000000000001976a914f4c6c5bb10ea6370a13b96cc08870628b76ad06e88ac00000000000100be0200000001b56260312db89d35878da2c9c65105b101b93b14c57c3105c2ea3cc516093fc7010000006b483045022100d5ee984dedc90f7f7ff1d0feb4964ee86f640d987929ff59d04ad63f106d1c74022005582bc3ade636536fc955b16a702d2ef467d6a27e82ab69616205b1c58883b20121028154c8e5566685a645cd992fb2f39c310b810ad0312427b56c1778ad7c6bdcc9ffffffff01204e00000000000017a914464ce725630f2002e79163552a24eabc2749bbb4870000000001048b5221025be3bf4b6fe0e1ad2d754b9a65bb3a22fcbf914dccbbe38d812604e7d34f06fb21030292a53b595066c420ddb082d9be4095c2bf9db8107ccc0f8049d14c86cf44b72103179961604ae4663eab2998d9a48c11e7e5866a4e43c98f1489f8ecffd163e0b12103a8c07929ef23231e8b3e5cc7ad3031524e2f7cb04fd0a66bc2b45e3a3244629554ae0000")
        try psbt.signInput(with: keys[0], at: 0)
        try psbt.signInput(with: keys[2], at: 0)
        try psbt.finalizeAllInputs()
        XCTAssertEqual(psbt.extractTransaction().serialized().hex, "0200000001ecfb41d7842ba9cbf16c80b1fba9930f6da0726623c0e1f5e3aec9e236839e5b00000000fd1f0100483045022100f171f3b040f1c5a581647a4a73d621128d4c41cea6f80ca7e196490dd14bd524022027f2237aa5463db23a94b7d98ff2ba1568f50f828bf237cfba03f1962e02492401473044022044ea0450a0beb54c46c5521646620fb9b22f7ac7b59d9061256a1081c224788002206369a6c56ec989082f6d3388d5c7c1abdc76db65a9ebca467f4c48e84036e447014c8b5221025be3bf4b6fe0e1ad2d754b9a65bb3a22fcbf914dccbbe38d812604e7d34f06fb21030292a53b595066c420ddb082d9be4095c2bf9db8107ccc0f8049d14c86cf44b72103179961604ae4663eab2998d9a48c11e7e5866a4e43c98f1489f8ecffd163e0b12103a8c07929ef23231e8b3e5cc7ad3031524e2f7cb04fd0a66bc2b45e3a3244629554aeffffffff0110270000000000001976a914f4c6c5bb10ea6370a13b96cc08870628b76ad06e88ac00000000")
    }

}
